<!DOCTYPE html>
<html lang="cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Muse',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="山佳">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="山佳">
<meta property="og:locale" content="cn">
<meta property="article:author" content="cui">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>山佳</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">山佳</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/2019/12/29/me/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2022/03/17/md%E8%AF%AD%E6%B3%95%E6%95%B4%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="cui">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="山佳">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/17/md%E8%AF%AD%E6%B3%95%E6%95%B4%E7%90%86/" class="post-title-link" itemprop="url">md语法整理</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-03-17 10:21:16 / Modified: 10:28:58" itemprop="dateCreated datePublished" datetime="2022-03-17T10:21:16+08:00">2022-03-17</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/03/17/md%E8%AF%AD%E6%B3%95%E6%95%B4%E7%90%86/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/03/17/md%E8%AF%AD%E6%B3%95%E6%95%B4%E7%90%86/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="markdown-使用整理"><a href="#markdown-使用整理" class="headerlink" title="markdown 使用整理"></a>markdown 使用整理</h1><h2 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h2><p>标题分级<br>使用#号不同的个数来组合实现<br>一个最大 依次减少 一共六级<br>第一级和第二级在内容下会有分割线</p>
<pre><code># 大
## 大
### 小</code></pre><h2 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h2><h3 id="正文标准文字-段落"><a href="#正文标准文字-段落" class="headerlink" title="正文标准文字/段落"></a>正文标准文字/段落</h3><p>可以直接进行书写， 如果不换行长度够了之后会自动换行。<br>如果是段落也不需要缩进<br>If you paste a message from somewhere else<br>this is next line </p>
<h3 id="文字加粗倾斜"><a href="#文字加粗倾斜" class="headerlink" title="文字加粗倾斜"></a>文字加粗倾斜</h3><p> 可以在文字的两端加上 <code>**</code>或者<code>__</code> 实现加粗。加上 <code>_</code>或者 <code>*</code> 实现倾斜。<br> <code>***</code> 则是加粗倾斜</p>
<pre><code>**加粗文体**  
_倾斜文字_
___加粗倾斜文字___</code></pre><p><strong>加粗文体</strong><br><em>倾斜文字</em><br><strong><em>加粗倾斜文字</em></strong></p>
<h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><p> 单行引用可以在开头使用 <code>&gt;</code> 来实现效果</p>
<pre><code>&gt; 这是一行引用文字</code></pre><blockquote>
<p>这是一行引用文字</p>
</blockquote>
<p>引用可以嵌套</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; 第一行</span><br><span class="line">&gt;&gt; 第二行</span><br></pre></td></tr></table></figure>

<blockquote>
<p>第一行</p>
<blockquote>
<p>第二行</p>
</blockquote>
</blockquote>
<p>引用块的书写，可以开头结尾加上 <code>&gt;&gt;&gt;</code>或者 <code>~~~</code> ，开头注意换行</p>
<pre><code>&gt;&gt;&gt;
If you paste a message from somewhere else

that spans multiple lines,

you can quote that without having to manually prepend `&gt;` to every line!
&gt;&gt;&gt;</code></pre><blockquote>
<blockquote>
<blockquote>
</blockquote>
<pre><code>If you paste a message from somewhere else</code></pre></blockquote>
</blockquote>
<pre><code>that spans multiple lines,

you can quote that without having to manually prepend `&gt;` to every line!</code></pre><blockquote>
<blockquote>
<blockquote>
</blockquote>
</blockquote>
</blockquote>
<h3 id="代码块"><a href="#代码块" class="headerlink" title="代码块"></a>代码块</h3><p>行内代码可以在开头结尾使用反单引号 ` 来实现效果</p>
<blockquote>
<blockquote>
<blockquote>
<p>`code`</p>
<p><code>code</code></p>
</blockquote>
</blockquote>
</blockquote>
<p>代码块可以在开头结尾加上三个反单引号 ```来实现效果, 还可以表明代码的语言类型, 会有代码高亮的效果。 </p>
<pre><code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">function</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="comment">#indenting works just fine in the fenced code block</span></span><br><span class="line">        s = <span class="string">"Python code"</span></span><br><span class="line">        <span class="keyword">print</span> s</span><br><span class="line">    ```  </span><br><span class="line">    </span><br><span class="line">```python</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">function</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="comment">#indenting works just fine in the fenced code block</span></span><br><span class="line">        s = <span class="string">"Python code"</span></span><br><span class="line">        <span class="keyword">print</span> s</span><br><span class="line">``` </span><br><span class="line">这是个json格式的</span><br><span class="line">```json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"title"</span>: <span class="string">"About Front Matter"</span></span><br><span class="line">  <span class="string">"example"</span>: &#123;</span><br><span class="line">    <span class="string">"language"</span>: <span class="string">"json"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre><h3 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h3><p>带数字的列表,可以通过加前缀 <code>1.</code>实现。如果是无序的队列,可以通过通过增加 <code>-、+、*</code> 前缀来实现 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. item</span><br><span class="line">2. item</span><br></pre></td></tr></table></figure>
<ol>
<li>item</li>
<li>item<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- item</span><br><span class="line">- item</span><br><span class="line">- item</span><br><span class="line">    - item</span><br><span class="line">    - item</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>item</li>
<li>item</li>
<li>item<ul>
<li>item</li>
<li>item</li>
</ul>
</li>
</ul>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>注释通过在 md 里创建 <code>[^*]</code> 对象，在对应位置引用</p>
<pre><code>A footnote reference tag looks like this: [^1]
This reference tag is a mix of letters and numbers. [^footnote-42]


[^1]: This text is inside a footnote.
[^footnote-42]: This text is another footnote.</code></pre><p>A footnote reference tag looks like this: [^1]<br>    This reference tag is a mix of letters and numbers. [^footnote-42]</p>
<p>[^1]: This text is inside a footnote.<br>[^footnote-42]: This text is another footnote.</p>
<h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><p>通过英文的 <code>｜和—-以及:</code>组合实现基本的表格设置</p>
<pre><code>|title1|title2|
|--|--|
|column|column|</code></pre><table>
<thead>
<tr>
<th>title1</th>
<th>title2</th>
</tr>
</thead>
<tbody><tr>
<td>column</td>
<td>column</td>
</tr>
</tbody></table>
<p>通过 <code>--和:</code> 的组合设置对其方式。</p>
<h2 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h2><p>md可以直接识别一个URL链接，也可以通过 <code>[name](url)</code> 来格式化。</p>
<pre><code>http://api.*.net/customer/v2.0/weChat/auth</code></pre><p><a href="http://api.*.net/customer/v2.0/weChat/auth" target="_blank" rel="noopener">http://api.*.net/customer/v2.0/weChat/auth</a></p>
<pre><code>[Link](http://api.*.net/customer/v2.0/weChat/auth)</code></pre><p><a href="http://api.*.net/customer/v2.0/weChat/auth" target="_blank" rel="noopener">Link</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2022/01/03/%E7%B3%BB%E7%BB%9F%E5%85%A8%E5%B1%80JSON%E8%AE%BE%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="cui">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="山佳">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/03/%E7%B3%BB%E7%BB%9F%E5%85%A8%E5%B1%80JSON%E8%AE%BE%E7%BD%AE/" class="post-title-link" itemprop="url">Spring Boot配置 jackson 序列化一系列的参数</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-03 18:12:51" itemprop="dateCreated datePublished" datetime="2022-01-03T18:12:51+08:00">2022-01-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-08 16:25:37" itemprop="dateModified" datetime="2022-02-08T16:25:37+08:00">2022-02-08</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/01/03/%E7%B3%BB%E7%BB%9F%E5%85%A8%E5%B1%80JSON%E8%AE%BE%E7%BD%AE/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/03/%E7%B3%BB%E7%BB%9F%E5%85%A8%E5%B1%80JSON%E8%AE%BE%E7%BD%AE/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Spring-Boot配置-jackson-序列化一系列的参数"><a href="#Spring-Boot配置-jackson-序列化一系列的参数" class="headerlink" title="Spring Boot配置 jackson 序列化一系列的参数"></a>Spring Boot配置 jackson 序列化一系列的参数</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><ol>
<li>开发阶段，前端组同事要求返回数据中对空值做同意的处理，字符串返回字符串，数组返回空数组等。想起之前见过类似的配置操作，所以一番操作之后。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableWebMvc</span><br><span class="line">public class JinWeiConvertersConfigurer implements WebMvcConfigurer &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) &#123;</span><br><span class="line">        &#x2F;&#x2F;1.需要先定义一个 convert 转换消息的对象;</span><br><span class="line">        FastJsonHttpMessageConverter fastConverter &#x3D; new FastJsonHttpMessageConverter();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;2、添加fastJson 的配置信息，比如：是否要格式化返回的json数据;</span><br><span class="line">        FastJsonConfig fastJsonConfig &#x3D; new FastJsonConfig();</span><br><span class="line">        &#x2F;&#x2F; 不忽略对象属性中的null值</span><br><span class="line">        fastJsonConfig.setSerializerFeatures(</span><br><span class="line">                PrettyFormat,</span><br><span class="line">                WriteMapNullValue,</span><br><span class="line">                WriteNullListAsEmpty,</span><br><span class="line">                WriteNullStringAsEmpty,</span><br><span class="line">                WriteNullNumberAsZero,</span><br><span class="line">                WriteDateUseDateFormat);</span><br><span class="line">        &#x2F;&#x2F;3、在convert中添加配置信息.</span><br><span class="line">        fastConverter.setFastJsonConfig(fastJsonConfig);</span><br><span class="line">        &#x2F;&#x2F;4、将convert添加到converters当中.</span><br><span class="line">        converters.add(fastConverter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>可以注意到这个配置主要是通过 FastJsonHttpMessageConverter 来实现的，不过很快就发现了问题，项目配置的Swagger UI无法访问了，所以就有了如下的代码增加：(在配置累中增加了 addResourceHandlers 函数)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void addResourceHandlers(ResourceHandlerRegistry registry) &#123;</span><br><span class="line">    &#x2F;&#x2F; 注意 :</span><br><span class="line">    &#x2F;&#x2F; 1. addResourceHandler 参数可以有多个</span><br><span class="line">    &#x2F;&#x2F; 2. addResourceLocations 参数可以是多个，可以混合使用 file: 和 classpath : 资源路径</span><br><span class="line">    &#x2F;&#x2F; 3. addResourceLocations 参数中资源路径必须使用 &#x2F; 结尾，如果没有此结尾则访问不到</span><br><span class="line">    &#x2F;&#x2F; 映射到文件系统中的静态文件(应用运行时，这些文件无业务逻辑，但可能被替换或者修改)</span><br><span class="line">    &#x2F;&#x2F;过滤swagger</span><br><span class="line">    registry.addResourceHandler(&quot;swagger-ui.html&quot;)</span><br><span class="line">            .addResourceLocations(&quot;classpath:&#x2F;META-INF&#x2F;resources&#x2F;“);</span><br><span class="line">    registry.addResourceHandler(&quot;&#x2F;webjars&#x2F;**&quot;)</span><br><span class="line">            .addResourceLocations(&quot;classpath:&#x2F;META-INF&#x2F;resources&#x2F;webjars&#x2F;&quot;);</span><br><span class="line">    registry.addResourceHandler(&quot;&#x2F;swagger-resources&#x2F;**&quot;)</span><br><span class="line">            .addResourceLocations(&quot;classpath:&#x2F;META-INF&#x2F;resources&#x2F;swagger-resources&#x2F;&quot;);</span><br><span class="line">    registry.addResourceHandler(&quot;&#x2F;swagger&#x2F;**&quot;)</span><br><span class="line">            .addResourceLocations(&quot;classpath:&#x2F;META-INF&#x2F;resources&#x2F;swagger*&quot;);</span><br><span class="line">    registry.addResourceHandler(&quot;&#x2F;v2&#x2F;api-docs&#x2F;**&quot;)</span><br><span class="line">            .addResourceLocations(&quot;classpath:&#x2F;META-INF&#x2F;resources&#x2F;v2&#x2F;api-docs&#x2F;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>好景不长，很快又发现时间等的格式有些对不上，频繁的修改我意识到是不是又哪儿不太对，通过对系统代码和配置的检查，我意识到同事搭建的这套系统默认使用的是Jackson，所以通过FastJson设置的这些空处置防范无法奏效，所以<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">package net.jinwei.config.converters;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.serializer.SerializeConfig;</span><br><span class="line">import com.alibaba.fastjson.support.config.FastJsonConfig;</span><br><span class="line">import com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.http.converter.HttpMessageConverter;</span><br><span class="line">import org.springframework.http.converter.StringHttpMessageConverter;</span><br><span class="line">import org.springframework.http.converter.json.MappingJackson2HttpMessageConverter;</span><br><span class="line">import org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br><span class="line">import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line">import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import java.math.BigDecimal;</span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 功能简要</span><br><span class="line"> * 消息转换配置</span><br><span class="line"> *</span><br><span class="line"> * @author xbcui</span><br><span class="line"> * createTime 2021&#x2F;12&#x2F;24 9:52 AM</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration</span><br><span class="line">@EnableWebMvc</span><br><span class="line">public class JinWeiConvertersConfigurer  implements WebMvcConfigurer &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) &#123;</span><br><span class="line">        &#x2F;&#x2F;在json转换之前先进行string转换</span><br><span class="line">        converters.add(new StringHttpMessageConverter());</span><br><span class="line">        &#x2F;&#x2F;添加json转换</span><br><span class="line">        MappingJackson2HttpMessageConverter jackson2HttpMessageConverter &#x3D; new MappingJackson2HttpMessageConverter();</span><br><span class="line">        jackson2HttpMessageConverter.setObjectMapper(new ConvertersJsonMapper());</span><br><span class="line">        converters.add(jackson2HttpMessageConverter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void addResourceHandlers(ResourceHandlerRegistry registry) &#123;</span><br><span class="line">        &#x2F;&#x2F;过滤swagger</span><br><span class="line">        registry.addResourceHandler(&quot;swagger-ui.html&quot;)</span><br><span class="line">                .addResourceLocations(&quot;classpath:&#x2F;META-INF&#x2F;resources&#x2F;&quot;);</span><br><span class="line">        registry.addResourceHandler(&quot;&#x2F;webjars&#x2F;**&quot;)</span><br><span class="line">                .addResourceLocations(&quot;classpath:&#x2F;META-INF&#x2F;resources&#x2F;webjars&#x2F;&quot;);</span><br><span class="line">        registry.addResourceHandler(&quot;&#x2F;swagger-resources&#x2F;**&quot;)</span><br><span class="line">                .addResourceLocations(&quot;classpath:&#x2F;META-INF&#x2F;resources&#x2F;swagger-resources&#x2F;&quot;);</span><br><span class="line">        registry.addResourceHandler(&quot;&#x2F;swagger&#x2F;**&quot;)</span><br><span class="line">                .addResourceLocations(&quot;classpath:&#x2F;META-INF&#x2F;resources&#x2F;swagger*&quot;);</span><br><span class="line">        registry.addResourceHandler(&quot;&#x2F;v2&#x2F;api-docs&#x2F;**&quot;)</span><br><span class="line">                .addResourceLocations(&quot;classpath:&#x2F;META-INF&#x2F;resources&#x2F;v2&#x2F;api-docs&#x2F;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">package net.jinwei.config.converters;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import com.fasterxml.jackson.core.JsonGenerator;</span><br><span class="line">import com.fasterxml.jackson.databind.JsonSerializer;</span><br><span class="line">import com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line">import com.fasterxml.jackson.databind.SerializerProvider;</span><br><span class="line">import com.fasterxml.jackson.databind.module.SimpleModule;</span><br><span class="line">import com.fasterxml.jackson.databind.ser.std.ToStringSerializer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line">import java.text.SimpleDateFormat;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.Objects;</span><br><span class="line">import java.util.TimeZone;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import static com.fasterxml.jackson.databind.DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 功能简要</span><br><span class="line"> * 转JSON 空值处理</span><br><span class="line"> *</span><br><span class="line"> * @author xbcui</span><br><span class="line"> * createTime 2021&#x2F;12&#x2F;29 5:25 PM</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class ConvertersJsonMapper extends ObjectMapper &#123;</span><br><span class="line">    public ConvertersJsonMapper() &#123;</span><br><span class="line">        super();</span><br><span class="line">        &#x2F;&#x2F;收到未知属性时不报异常</span><br><span class="line">        this.configure(FAIL_ON_UNKNOWN_PROPERTIES, false);</span><br><span class="line">        this.setDateFormat(new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span><br><span class="line">        this.setTimeZone(TimeZone.getTimeZone(&quot;GMT+8&quot;));</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;Long类型转为String类型</span><br><span class="line">        SimpleModule simpleModule &#x3D; new SimpleModule();</span><br><span class="line">        simpleModule.addSerializer(Long.class, ToStringSerializer.instance);</span><br><span class="line">        simpleModule.addSerializer(Long.TYPE, ToStringSerializer.instance);</span><br><span class="line">        this.registerModule(simpleModule);</span><br><span class="line">        &#x2F;&#x2F;处理null时设置的值</span><br><span class="line">        this.getSerializerProvider().setNullValueSerializer(new JsonSerializer&lt;Object&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void serialize(Object value, JsonGenerator gen, SerializerProvider serializers) throws IOException &#123;</span><br><span class="line">                String fieldName &#x3D; gen.getOutputContext().getCurrentName();</span><br><span class="line">                try &#123;</span><br><span class="line">                    &#x2F;&#x2F;反射获取字段类型</span><br><span class="line">                    Field field &#x3D; gen.getCurrentValue().getClass().getDeclaredField(fieldName);</span><br><span class="line">                    if (Objects.equals(field.getType(), String.class)) &#123;</span><br><span class="line">                        &#x2F;&#x2F;字符串型空值&quot;&quot;</span><br><span class="line">                        gen.writeString(&quot;&quot;);</span><br><span class="line">                        return;</span><br><span class="line">                    &#125; else if (Objects.equals(field.getType(), List.class)) &#123;</span><br><span class="line">                        &#x2F;&#x2F;列表型空值返回[]</span><br><span class="line">                        gen.writeStartArray();</span><br><span class="line">                        gen.writeEndArray();</span><br><span class="line">                        return;</span><br><span class="line">                    &#125; else if (Objects.equals(field.getType(), Map.class)) &#123;</span><br><span class="line">                        &#x2F;&#x2F;map型空值返回&#123;&#125;</span><br><span class="line">                        gen.writeStartObject();</span><br><span class="line">                        gen.writeEndObject();</span><br><span class="line">                        return;</span><br><span class="line">                    &#125; else if(Objects.equals(field.getType(), Long.class))&#123;</span><br><span class="line">                        gen.writeNumber(0);</span><br><span class="line">                        return;</span><br><span class="line">                    &#125;else if (Objects.equals(field.getType(), String[].class)) &#123;</span><br><span class="line">                        &#x2F;&#x2F;列表型空值返回[]</span><br><span class="line">                        gen.writeStartArray();</span><br><span class="line">                        gen.writeEndArray();</span><br><span class="line">                        return;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (NoSuchFieldException e) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">                &#x2F;&#x2F;默认返回&quot;&quot;</span><br><span class="line">                gen.writeString(&quot;&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ol>
<h2 id="HttpMessageConverter"><a href="#HttpMessageConverter" class="headerlink" title="HttpMessageConverter"></a>HttpMessageConverter</h2><p>经过这次的修改，我决定总结下相关的东西。</p>
<h3 id="HttpMessageConverter是什么"><a href="#HttpMessageConverter是什么" class="headerlink" title="HttpMessageConverter是什么"></a>HttpMessageConverter是什么</h3><p>官方文档介绍：</p>
<blockquote>
<p>HttpMessageConverter is responsible for converting from the HTTP request message to an object and converting from an object to the HTTP response body</p>
</blockquote>
<p>DispatcherServlet默认已经安装了AnnotationMethodHandlerAdapter作为HandlerAdapter组件的实现类，HttpMessageConverter即由AnnotationMethodHandlerAdapter使用，将请求信息转换为对象，或将对象转换为响应信息。</p>
<h3 id="HttpMessageConverter怎么生效"><a href="#HttpMessageConverter怎么生效" class="headerlink" title="HttpMessageConverter怎么生效"></a>HttpMessageConverter怎么生效</h3><p><em>如何使用HttpMessageConverter<T>  将请求信息转化并绑定到处理方法的入参当中呢？</em><br>可以通过两种方式实现：      </p>
<ol>
<li>使用@RequestBody/@ResponseBody对处理方法进行标注     </li>
<li>使用HttpEntity<T>/ResponseEntity<T>作为处理方法的入参或者返回值</li>
</ol>
<p><em>处理方法如何知道请求消息的格式?在处理完成后又是根据什么确定响应消息的格式</em><br>可以根据请求消息头的”Content-Type“及Accept属性确定。</p>
<p>HttpMessageConverter这个接口，简单说就是HTTP的request和response的转换器，在遇到@RequestBody时候SpringBoot会选择一个合适的HttpMessageConverter实现类来进行转换，内部有很多实现类，也可以自己实现，如果这个实现类能处理这个数据，那么它的canRead()方法会返回true，SpringBoot会调用他的read()方法从请求中读出并转换成实体类，同样canWrite也是。</p>
<h3 id="自定义HttpMessageConverter实现"><a href="#自定义HttpMessageConverter实现" class="headerlink" title="自定义HttpMessageConverter实现"></a>自定义HttpMessageConverter实现</h3><p>文档：<br><code>Customization of HttpMessageConverter can be achieved in Java config by overriding configureMessageConverters() if you want to replace the default converters created by Spring MVC, or by overriding extendMessageConverters() if you just want to customize them or add additional converters to the default ones.</code><br>如果想替换默认的converter，通过重写configureMessageConverters()这个方法。<br>而如果你想添加一个自定义converter，通过重写extendMessageConverters()这个方法。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/12/26/Spring%20Boot%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C%E6%9C%BA%E5%88%B6%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="cui">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="山佳">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/26/Spring%20Boot%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C%E6%9C%BA%E5%88%B6%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/" class="post-title-link" itemprop="url">Spring Boot参数校验机制介绍及问题排查</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-12-26 16:32:26" itemprop="dateCreated datePublished" datetime="2021-12-26T16:32:26+08:00">2021-12-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-08 16:25:26" itemprop="dateModified" datetime="2022-02-08T16:25:26+08:00">2022-02-08</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2021/12/26/Spring%20Boot%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C%E6%9C%BA%E5%88%B6%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/12/26/Spring%20Boot%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C%E6%9C%BA%E5%88%B6%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Spring-Boot参数校验机制介绍及问题排查"><a href="#Spring-Boot参数校验机制介绍及问题排查" class="headerlink" title="Spring Boot参数校验机制介绍及问题排查"></a>Spring Boot参数校验机制介绍及问题排查</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>公司新的系统版本从Spring cloud Alibaba 微服务简化为Spring Boot的一个单服务，但是代码架构还是按照服务做了简单的模块划分。<br>接口系统上参数校验使用了 <code>hibernate validator</code>, 这个包还是很好用的。hibernate validator 是对 Jakarta Bean Validation规范的实现的一种。</p>
<h2 id="Jakarta-Bean-Validation-介绍"><a href="#Jakarta-Bean-Validation-介绍" class="headerlink" title="Jakarta Bean Validation 介绍"></a>Jakarta Bean Validation 介绍</h2><p>Jakarta Bean Validation 据说之前是Java Bean Validation, Bean Validation 技术隶属于Java EE规范，期间有多个JSR（Java Specification Request）支持（303、349、380），他是一种规范是标准，hibernate validator是对他的一种实现。所以处理几个JSR规定的一些规范注解外，hibernate validator 还提供了一些别的使用的注解。Spring Boot已经引用hibernate-validator包。所以我们Spring Boot项目不用单独导包，就可以直接使用。就像Jakarta Bean Validation 自己介绍说的</p>
<blockquote>
<p>Constrain once, validate everywhere</p>
</blockquote>
<p>附上文档地址：</p>
<ol>
<li><a href="http://hibernate.org/validator/" target="_blank" rel="noopener">hibernate validator</a></li>
<li><a href="https://beanvalidation.org" target="_blank" rel="noopener">Jakarta Bean Validation</a></li>
</ol>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>新的系统架构现在主要在开发测试阶段，自测开发的模块时发现参数校验的几个注解不生效（@NotBlank、@NotEmpty）。<br>几个注解的含义</p>
<blockquote>
<p>@NotNull： 不能为null，但可以为empty，用在基本类型上。<br>@NotEmpty：不能为null，而且长度必须大于0，用在集合类上。<br>@NotBlank：不能为null，而且调用trim()后，长度必须大于0，只能作用在String上。</p>
</blockquote>
<p><a href="https://beanvalidation.org/2.0/spec/#builtinconstraints" target="_blank" rel="noopener">主要校验注解介绍文档传送门</a></p>
<h2 id="处理"><a href="#处理" class="headerlink" title="处理"></a>处理</h2><ol>
<li>最早出现这个问题时，随手查了下， 说是需要在controller层参数上加伤 @Valid注解，确实没有加，但是加上之后发现还是没有生效，但是@NotNull可以起作用（可惜它不能满足需求）。</li>
<li>继续肝，发现如果import的NotBlank的包，特意指定到hibernate-validator目录下的包就可以了，这里肯定有一些包上的问题。</li>
<li>使用 MavenHelper 和 mvn dependency:tree命令查找发现，项目里有个独立引用的hibernate-validator包而且版本比较老旧，直接干掉了。</li>
<li>问题解决。</li>
</ol>
<h2 id="另外"><a href="#另外" class="headerlink" title="另外"></a>另外</h2><p>对于这个的检查结果，因为主要是在controller使用，建议做统一处理，可以使用@ControllerAdvice注解。</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>spring boot项目不需要独立的引用hibernate-validator包，核心包里已经带了；另外包的版本变化还是挺大的哦。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/12/26/Docker%E9%83%A8%E7%BD%B2Logstash%E5%90%8C%E6%AD%A5mysql%E6%95%B0%E6%8D%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="cui">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="山佳">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/26/Docker%E9%83%A8%E7%BD%B2Logstash%E5%90%8C%E6%AD%A5mysql%E6%95%B0%E6%8D%AE/" class="post-title-link" itemprop="url">Docker部署Logstash记</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-12-26 16:03:31" itemprop="dateCreated datePublished" datetime="2021-12-26T16:03:31+08:00">2021-12-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-08 16:25:13" itemprop="dateModified" datetime="2022-02-08T16:25:13+08:00">2022-02-08</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2021/12/26/Docker%E9%83%A8%E7%BD%B2Logstash%E5%90%8C%E6%AD%A5mysql%E6%95%B0%E6%8D%AE/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/12/26/Docker%E9%83%A8%E7%BD%B2Logstash%E5%90%8C%E6%AD%A5mysql%E6%95%B0%E6%8D%AE/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Docker部署Logstash记"><a href="#Docker部署Logstash记" class="headerlink" title="Docker部署Logstash记"></a>Docker部署Logstash记</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>之前学习Docker，练习时已经在Docker安装了es和kibana容器（此处很简单，只需注意docker镜像的版本对照）。最近公司在上马ES作为数据查询出口的主力，所以想在本地试验下Logstash数据收集同步。</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><h3 id="安装logstash"><a href="#安装logstash" class="headerlink" title="安装logstash"></a>安装logstash</h3><p>之前安装的ES和Kibana版本都是7.6.0， 版本不用纠结。<br><code>docker pull logstash:7.6.0</code></p>
<h3 id="获取配置文件"><a href="#获取配置文件" class="headerlink" title="获取配置文件"></a>获取配置文件</h3><p>logstash的配置文件，如果手上没有，可以启动logstash后获取默认配置文件。<br><code>docker run -d -p 5044:5044 --name logstash  logstash:7.6.0</code></p>
<h3 id="查看日志信息-是否启动成功"><a href="#查看日志信息-是否启动成功" class="headerlink" title="查看日志信息 是否启动成功"></a>查看日志信息 是否启动成功</h3><p><code>docker logs -f logstash</code></p>
<h3 id="本地环境创建所需挂载文件夹"><a href="#本地环境创建所需挂载文件夹" class="headerlink" title="本地环境创建所需挂载文件夹"></a>本地环境创建所需挂载文件夹</h3><p><code>mkdir -p ~/docker/logstash</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker cp logstash:&#x2F;usr&#x2F;share&#x2F;logstash&#x2F;config ~&#x2F;docker&#x2F;logstash&#x2F;</span><br><span class="line">docker cp logstash:&#x2F;usr&#x2F;share&#x2F;logstash&#x2F;data ~&#x2F;docker&#x2F;logstash&#x2F;</span><br><span class="line">docker cp logstash:&#x2F;usr&#x2F;share&#x2F;logstash&#x2F;pipeline ~&#x2F;docker&#x2F;logstash&#x2F;</span><br></pre></td></tr></table></figure>
<h3 id="修改配置文件-logstash-ymls-的内容"><a href="#修改配置文件-logstash-ymls-的内容" class="headerlink" title="修改配置文件 logstash.ymls 的内容"></a>修改配置文件 logstash.ymls 的内容</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http.host: &quot;0.0.0.0&quot;</span><br><span class="line">xpack.monitoring.elasticsearch.hosts: [ &quot;http:&#x2F;&#x2F;127.0.0.1:9200&quot; ]</span><br><span class="line">#path.config: &#x2F;usr&#x2F;share&#x2F;logstash&#x2F;config&#x2F;conf.d&#x2F;*.conf</span><br><span class="line">path.logs: &#x2F;usr&#x2F;share&#x2F;logstash&#x2F;logs</span><br></pre></td></tr></table></figure>

<h3 id="文件夹赋权"><a href="#文件夹赋权" class="headerlink" title="文件夹赋权"></a>文件夹赋权</h3><p><code>chmod -R 777 ~/docker/logstash/</code></p>
<h3 id="删除之前的容器，重新创建新的容器-重新启动"><a href="#删除之前的容器，重新创建新的容器-重新启动" class="headerlink" title="删除之前的容器，重新创建新的容器,重新启动"></a>删除之前的容器，重新创建新的容器,重新启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">--name logstash \</span><br><span class="line">--restart&#x3D;always \</span><br><span class="line">-p 5044:5044 \</span><br><span class="line">-p 9600:9600 \</span><br><span class="line">-e ES_JAVA_OPTS&#x3D;&quot;-Duser.timezone&#x3D;Asia&#x2F;Shanghai&quot; \</span><br><span class="line">-v &#x2F;Users&#x2F;xbcui&#x2F;docker&#x2F;logstash&#x2F;config:&#x2F;usr&#x2F;share&#x2F;logstash&#x2F;config \</span><br><span class="line">-v &#x2F;Users&#x2F;xbcui&#x2F;docker&#x2F;logstash&#x2F;data:&#x2F;usr&#x2F;share&#x2F;logstash&#x2F;data -v &#x2F;Users&#x2F;xbcui&#x2F;docker&#x2F;logstash&#x2F;pipeline:&#x2F;usr&#x2F;share&#x2F;logstash&#x2F;pipeline \</span><br><span class="line">-v &#x2F;Users&#x2F;xbcui&#x2F;docker&#x2F;logstash&#x2F;pipeline&#x2F;mysql-connector-java-8.0.22.jar:&#x2F;&#x2F;usr&#x2F;share&#x2F;logstash&#x2F;config&#x2F;jars&#x2F;mysql-connector-java-8.0.22.jar \</span><br><span class="line">-d logstash:7.6.0</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<blockquote>
<p>docker run <br>–name logstash\ 将容器命名为 logstash<br>–restart=always \ 容器自动重启<br>-p 5044:5044 \ 将容器的5044端口映射到宿主机5044端口 logstash的启动端口<br>-p 9600:9600 \ 将容器的9600端口映射到宿主机9600 端口，api端口<br>-e ES_JAVA_OPTS=”-Duser.timezone=Asia/Shanghai” \ 设置时区<br>-v /Users/xbcui/docker/logstash/data:/usr/share/logstash/data -v /Users/xbcui/docker/logstash/pipeline:/usr/share/logstash/pipeline <br>-v /Users/xbcui/docker/logstash/pipeline/mysql-connector-java-8.0.22.jar://usr/share/logstash/config/jars/mysql-connector-java-8.0.22.jar \ 挂载<br>-d logstash:7.6.0 后台运行容器，并返回容器ID</p>
</blockquote>
<h3 id="查看logstash新的容器是否启动成功"><a href="#查看logstash新的容器是否启动成功" class="headerlink" title="查看logstash新的容器是否启动成功"></a>查看logstash新的容器是否启动成功</h3><p><code>docker ps</code><br><code>docker logs -f --tail 200 logstash</code></p>
<h3 id="mysql同步配置"><a href="#mysql同步配置" class="headerlink" title="mysql同步配置"></a>mysql同步配置</h3><h4 id="先进入容器"><a href="#先进入容器" class="headerlink" title="先进入容器"></a>先进入容器</h4><p><code>docker exec -it logstash bash</code></p>
<h4 id="查看是否装有-logstash-input-jdbc-插件"><a href="#查看是否装有-logstash-input-jdbc-插件" class="headerlink" title="查看是否装有 logstash-input-jdbc 插件"></a>查看是否装有 logstash-input-jdbc 插件</h4><p><code>./bin/logstash-plugin list --verbose</code></p>
<h4 id="没有的话就安装，其实插件茫茫多"><a href="#没有的话就安装，其实插件茫茫多" class="headerlink" title="没有的话就安装，其实插件茫茫多"></a>没有的话就安装，其实插件茫茫多</h4><p><code>./bin/logstash-plugin install logstash-input-jdbc</code></p>
<h4 id="退出容器"><a href="#退出容器" class="headerlink" title="退出容器"></a>退出容器</h4><p><code>exit</code></p>
<h5 id="在文件目录-docker-logstash-config-conf-d下创建-jdbc-conf-文件"><a href="#在文件目录-docker-logstash-config-conf-d下创建-jdbc-conf-文件" class="headerlink" title="在文件目录 ~/docker/logstash/config/conf.d下创建 jdbc.conf 文件"></a>在文件目录 ~/docker/logstash/config/conf.d下创建 jdbc.conf 文件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">input&#123;</span><br><span class="line">     jdbc&#123;</span><br><span class="line">          # 连接数据库</span><br><span class="line">          jdbc_connection_string &#x3D;&gt; &quot;jdbc:mysql:&#x2F;&#x2F;192.168.99.205:3306&#x2F;database&quot;</span><br><span class="line">          jdbc_user &#x3D;&gt; &quot;user&quot;</span><br><span class="line">          jdbc_password &#x3D;&gt; &quot;pass&quot;</span><br><span class="line">          # 连接数据库的驱动包 需要手动导入到docker服务中</span><br><span class="line">          jdbc_driver_library &#x3D;&gt; &quot;&#x2F;usr&#x2F;share&#x2F;logstash&#x2F;pipeline&#x2F;mysql-connector-java-8.0.22.jar&quot;</span><br><span class="line">          jdbc_driver_class &#x3D;&gt; &quot;com.mysql.cj.jdbc.Driver&quot;</span><br><span class="line">          jdbc_paging_enabled &#x3D;&gt; &quot;true&quot;</span><br><span class="line">          jdbc_page_size &#x3D;&gt; &quot;50000&quot;</span><br><span class="line">          codec &#x3D;&gt; plain &#123; charset &#x3D;&gt; &quot;UTF-8&quot; &#125;</span><br><span class="line"></span><br><span class="line">          # 数据追踪</span><br><span class="line">          # 追踪的字段</span><br><span class="line">          tracking_column &#x3D;&gt; &quot;update_time&quot;</span><br><span class="line">          # 上次追踪的元数据存放位置</span><br><span class="line">          last_run_metadata_path &#x3D;&gt; &quot;&#x2F;usr&#x2F;share&#x2F;logstash&#x2F;config&#x2F;lastrun&#x2F;logstash_jdbc_last_run&quot;</span><br><span class="line">          # 设置时区</span><br><span class="line">          jdbc_default_timezone &#x3D;&gt; &quot;Asia&#x2F;Shanghai&quot;  </span><br><span class="line">          # sql 文件地址</span><br><span class="line">          # statement_filepath &#x3D;&gt; &quot;&quot;</span><br><span class="line">          # sql</span><br><span class="line">          statement &#x3D;&gt; &quot;select * from order_info&quot;</span><br><span class="line">          # 是否清除 last_run_metadata_path 的记录,如果为真那么每次都相当于从头开始查询所有的数据库记录</span><br><span class="line">          clean_run &#x3D;&gt;false</span><br><span class="line">          # 这是控制定时的，重复执行导入任务的时间间隔，第一位是分钟 不设置就是1分钟执行一次</span><br><span class="line">          schedule &#x3D;&gt; &quot;* *&#x2F;1 * * *&quot;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line">filter &#123;</span><br><span class="line">    date &#123;</span><br><span class="line">        match &#x3D;&gt; [&quot;order_time&quot;, &quot;yyyy-MM-dd HH:mm:ss&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output&#123;</span><br><span class="line">      elasticsearch&#123;</span><br><span class="line">                   # 要导入到的Elasticsearch所在的主机</span><br><span class="line">                   hosts &#x3D;&gt; &quot;192.168.98.169:9200&quot;</span><br><span class="line">                   # 要导入到的Elasticsearch的索引的名称</span><br><span class="line">                   index &#x3D;&gt; &quot;jinwei_order_2360s_index&quot;</span><br><span class="line">                   # 类型名称（类似数据库表名）</span><br><span class="line">                   document_type &#x3D;&gt; &quot;_doc&quot;</span><br><span class="line">                   # 主键名称（类似数据库表名）</span><br><span class="line">                   document_id &#x3D;&gt; &quot;%&#123;id&#125;&quot;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      stdout&#123;</span><br><span class="line">            # JSON 格式输出</span><br><span class="line">            codec &#x3D;&gt; json_lines</span><br><span class="line">      &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="将logstash-yml-中-path-config-usr-share-logstash-config-conf-d-conf这一行的注释放开"><a href="#将logstash-yml-中-path-config-usr-share-logstash-config-conf-d-conf这一行的注释放开" class="headerlink" title="将logstash.yml 中 path.config: /usr/share/logstash/config/conf.d/*.conf这一行的注释放开"></a>将logstash.yml 中 path.config: /usr/share/logstash/config/conf.d/*.conf这一行的注释放开</h4><h2 id="附：向Docker服务下载-上传文件"><a href="#附：向Docker服务下载-上传文件" class="headerlink" title="附：向Docker服务下载/上传文件"></a>附：向Docker服务下载/上传文件</h2><p>下载文件<br><code>docker cp logstash:/usr/share/logstash/data ~/docker/logstash/</code><br>上传文件<br>docker cp 本地文件路径 ID全称:容器路径<br><code>docker cp /Users/xbcui//elasticsearch-phone-.zip 609e6107f1210f20e8689e985bb7265d7ac0a453bb23eee36aed0c9c852801ea:usr/share/elasticsearch/plugins/elasticsearch-phone.zip</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/12/26/rocket_mq_error/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="cui">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="山佳">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/26/rocket_mq_error/" class="post-title-link" itemprop="url">RocketMQ 发送消息偶尔会无法消费</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-12-26 15:12:48" itemprop="dateCreated datePublished" datetime="2021-12-26T15:12:48+08:00">2021-12-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-08 16:24:57" itemprop="dateModified" datetime="2022-02-08T16:24:57+08:00">2022-02-08</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2021/12/26/rocket_mq_error/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/12/26/rocket_mq_error/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="RocketMQ-发送消息偶尔会无法消费"><a href="#RocketMQ-发送消息偶尔会无法消费" class="headerlink" title="RocketMQ 发送消息偶尔会无法消费"></a>RocketMQ 发送消息偶尔会无法消费</h1><h2 id="问题背景"><a href="#问题背景" class="headerlink" title="问题背景"></a>问题背景</h2><p> 公司全款支付业务上线在即，测试组同学反馈，测试环境偶现某些操作无效的问题。经排查是系统中使用的MQ出现了问题。<br> 消息队列是在老的生产环境就已经接入的，之前消息的传递是没有问题的。<br> 以上是主要背景</p>
<h2 id="排查过程"><a href="#排查过程" class="headerlink" title="排查过程"></a>排查过程</h2><ol>
<li><p>经过初步排查是消息队列中的消息没有被消费导致的。也就是生产者已经将消息发送到队列中，但是消费者没有消费到。</p>
</li>
<li><p>从消息队列控制台查看这个topic和消费组的一些消息，有几个消费组的消息是积压状态（最可以从topic - consumer管理 - 弹出界面中consumer offset 后的差值，如果不为0 说明消息积压）。这里有个点，消费挤压的消费者的消费者终端都是空的，此处先记下。</p>
</li>
<li><p>接下来因为认识不足的问题，问题解决方向侧重点放在了检查消费端的堵塞上，此处问题没有得到很好的解决，但是发现不少比较不错的文档，记录在文末。</p>
</li>
<li><p>在控制台具体查看消息的一些生命情况，通过Topic 和 时间过滤 找到最近产生的几条消息数据，打开 message detail，最下面会有关于消息的 trackType 和一些操作。观察到消费失败的消息的trackType的属性是 NOT_ONLINE, 即消费者没有运行。<br>这里展开说下 trackType 的类型和代表的含义。</p>
<blockquote>
<p><strong>NOT_ONLINE</strong> 代表该Consumer没有运行<br><strong>CONSUMED</strong> 代表该消息已经被消费<br><strong>NOT_CONSUME_YET</strong> 还没被消费<br><strong>UNKNOW_EXCEPTION</strong> 报错<br><strong>CONSUMED_BUT_FILTERED</strong> 消费了，但是被过滤了，一般是被tag过滤了</p>
</blockquote>
</li>
<li><p>在尝试联系运维同学重启了MQ之后，从消息队列的整个的配置上闲逛的时候，发现消费者的客户端的版本号存在多个，联系最近业务系统的测试和上线动作，新的测试环境部署了 流程引擎服务 的消费组名称和当前的同名，当时鉴于topic不一样，修改后未及时进行验证。</p>
</li>
<li><p>马上修改对应的服务的消费组名称， 问题解决。  <strong>不同的Topic的消费组名称也会冲突</strong>。</p>
</li>
</ol>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>消息队列使用时命名规范问题一定要注意，不同的项目的Topic、消费组名称和tag关系需要梳理。</p>
<h2 id="附录："><a href="#附录：" class="headerlink" title="附录："></a>附录：</h2><p>另附网上关于mq消息积压的案例有很多，但场景都不是很一样，从中找到排查步骤和工具不错的方案如下：</p>
<ol>
<li><a href="https://zhaibo.ink/2019/12/13/RocketMQ%25E6%25B6%2588%25E6%2581%25AF%25E7%25A7%25AF%25E5%258E%258B%25E9%2597%25AE%25E9%25A2%2598" target="_blank" rel="noopener">RocketMQ消息积压问题</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/413253642" target="_blank" rel="noopener">消息积压判断及解决</a></li>
</ol>
<h3 id="附录链接文字备份"><a href="#附录链接文字备份" class="headerlink" title="附录链接文字备份"></a>附录链接文字备份</h3><p>Part1:</p>
<blockquote>
<ol>
<li>可通过 jps -m 或者 ps -ef | grep java 命令获取当前正在运行的 Java 程序，通过启动主类即可获得应用的进程 id，然后可以通过 jstack pid &gt; j.log 命令获取线程的堆栈，在这里我建议大家连续运行 5 次该命令，分别获取 5 个线程堆栈文件，主要用于对比线程的状态是否在向前推进。</li>
<li>通过 jstack 获取堆栈信息后，重点搜索 线程状态。</li>
</ol>
</blockquote>
<p>Part2:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">一. 定位问题</span><br><span class="line">1. Console入口</span><br><span class="line">主题--&gt;Topic--&gt;Consumer管理--&gt;订阅组</span><br><span class="line"></span><br><span class="line">2. 延迟数量（Delay）</span><br><span class="line">消息积压数量，即当前Topic还剩下多少消息未处理，该值越大，表示积压的消息越多</span><br><span class="line"></span><br><span class="line">3. 最后消费时间（LastConsumeTime）</span><br><span class="line">当前Topic消息最后被消费的时间，该值表示消费端有多长时间未拉取消息进行消费</span><br><span class="line"></span><br><span class="line">二. 分析问题</span><br><span class="line">1. 查看rocketmq_client.log日志</span><br><span class="line">grep &quot;do flow control&quot; rocketmq_client.log</span><br><span class="line"></span><br><span class="line">如果出现 so do flow control 这样的日志，说明触发了消费限流，原因是：消费端积压了消息，即消费端无法消费已拉取的消息，消费端在没有将消息处理完成前，不会再向服务端拉取消息，并打印日志。</span><br><span class="line"></span><br><span class="line">2. 消费端业务逻辑</span><br><span class="line">    1. 执行了长耗时的逻辑，导致消息处理很慢</span><br><span class="line">    2. 第三方接口调用很慢或超时</span><br><span class="line">    </span><br><span class="line">三. 解决问题</span><br><span class="line">1. 消费端解决</span><br><span class="line">    1. 增加消费端的消费线程数或增加消费者数量，提升消费能力</span><br><span class="line">    2. 优化代码逻辑，降低执行时间</span><br><span class="line">    3. 调用第三方接口时，设置较短的超时时间，避免长时间等待，快速返回错误信息并告警</span><br></pre></td></tr></table></figure>

<p>Part3:</p>
<blockquote>
<p>出现场景<br>生产者系统会负责不停的把消息写入RocketMQ里去，然后消费者系统就是负责从RocketMQ里消费消息。</p>
</blockquote>
<blockquote>
<p>系统在生产环境是有高峰和低谷的，在晚上几个小时的高峰期内，大概就会有100多万条消息进入RocketMQ。然后消费者系统从RocketMQ里获取到消息之后，会依赖一些Redis去进行一些业务逻辑的实现。</p>
</blockquote>
<blockquote>
<p>有一天晚上就出现了一个问题，消费者系统依赖的Redis就挂掉了，导致消费者系统自己也没法运作了，此时就没法继续从RocketMQ里消费数据和处理了，消费者系统几乎就处于停滞不动的状态。然后生产者系统在晚上几个小时的高峰期内，就往MQ里写入了100多万的消息，此时都积压在MQ里了，根本没有系统消费和处理。</p>
</blockquote>
<blockquote>
<p>解决方案<br>一般来说有以下几种方案：</p>
</blockquote>
<blockquote>
<p>全部丢弃：如果这些消息允许丢失，那么此时可以紧急修改消费者系统的代码，在代码里对所有的消息都获取到就直接丢弃，不做任何的处理，这样可以迅速的让积压在MQ里的百万消息被处理掉，只不过处理方式就是全部丢弃而已。<br>等待Redis恢复：往往对很多系统而言，不能简单粗暴的丢弃这些消息，所以最常见的办法，还是先等待消费者系统底层依赖的Redis先恢复，恢复之后，就可以根据线上Topic的MessageQueue的数量来看看如何后续处理。<br>临时扩容消费者系统，增加机器来加快消费速度，但要考虑依赖的Redis也要能抗住压力；<br>临时扩容消费者系统<br>假如Topic有20个MessageQueue，然后只有4个消费者系统在消费，那么每个消费者系统会从5个MessageQueue里获取消息，所以此时如果你仅仅依靠4个消费者系统是肯定不够的，毕竟MQ里积压了百万消息了。</p>
</blockquote>
<blockquote>
<p>此时可以临时申请16台机器多部署16个消费者系统的实例，然后20个消费者系统同时消费，每个消费者消费一个MessageQueue的消息，此时会发现消费的速度提高了5倍，很快积压的百万消息都会被处理完毕。<br>但是这里同时要考虑到Redis必须要能抗住临时增加了5倍的读写压力，因为原来就4个消费者系统在读写Redis，现在临时变成了20个消费者系统了。</p>
</blockquote>
<blockquote>
<p>当你处理完百万积压的消息之后，就可以下线多余的16台机器了。</p>
</blockquote>
<blockquote>
<p>那么如果Topic总共就只有4个MessageQueue，只有4个消费者系统呢？<br>这个时候就没办法扩容消费者系统了，因为再多的消费者系统，还是只有4个MessageQueue，没法并行消费。</p>
</blockquote>
<blockquote>
<p>所以此时往往是临时修改那4个消费者系统的代码，让他们获取到消息然后不写入Redis，而是直接把消息写入一个新的Topic，这个速度是很快的，因为仅仅是读写MQ而已。</p>
</blockquote>
<blockquote>
<p>然后新的Topic有20个MessageQueue，然后再部署20台临时增加的消费者系统，去消费新的Topic后写入数据到NoSQL里去，这样子也可以迅速的增加消费者系统的并行处理能力，使用一个新的Topic来允许更多的消费者系统并行处理。</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/08/17/JMM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="cui">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="山佳">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/17/JMM/" class="post-title-link" itemprop="url">Java内存模型</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-08-17 18:11:30" itemprop="dateCreated datePublished" datetime="2021-08-17T18:11:30+08:00">2021-08-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-08-22 20:59:17" itemprop="dateModified" datetime="2021-08-22T20:59:17+08:00">2021-08-22</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2021/08/17/JMM/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/08/17/JMM/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="写在Java内存模型前面"><a href="#写在Java内存模型前面" class="headerlink" title="写在Java内存模型前面"></a>写在Java内存模型前面</h1><blockquote>
<p>JAVA依旧是当前比较受欢迎的面向对象的开发语言，Java 编程语言是个简单、面向对象、分布式、解释性、健壮、安全与系统无关、可移植、高性能、多线程和静态的语言。<br>作为程序员摊开来说Java，说起Java一般接下来会有几个定义：JDK、JRE、JVM。<br>JDK（Java Development kit）是针对开发的产品，是整个Java的核心，它包括了Java运行环境JRE、Java工具和Java基础类库。<br>JRE（Java Runtime Environment）是运行Java程序所必需的环境的集合，它包括JVM标准实现和Java核心类库。<br>JVM（Java virtual Machine）Java虚拟机，是整个Java实现跨平台的最核心的产品，能够与性Java写作的软件程序。所有的Java程序会被编译成.class的类文件，这种类文件可以在虚拟机上执行，也就是说，class并不直接操作机器的操作系统，而是经过虚拟机间接的与操作系统交互，有虚拟机将程序解释给本地系统执行。</p>
</blockquote>
<img src="https://www.2360s.top/pic/java_base.png" width="100%" height="100%">


<h1 id="关于JMM"><a href="#关于JMM" class="headerlink" title="关于JMM"></a>关于JMM</h1><blockquote>
<p>JMM（Java Memory Model）,Java内存模型，其实是一套内存模型规范，屏蔽了各种硬件和操作系统访问差异，保证Java程序在各种平台下对内存的访问的效果都一致。<br>Java程序的内存的分配是在JVM虚拟机内存分配机制下完成的。<br>Java内存共分为五部分： 虚拟机栈、 堆、 方法区、 本地方法栈、程序计数器。</p>
</blockquote>
<h2 id="程序计数器"><a href="#程序计数器" class="headerlink" title="程序计数器"></a>程序计数器</h2><blockquote>
<p>这一部分是当前线程锁定执行字节码的行号指示器，是一块较小的内存空间。程序计数器是线程私有的。Java虚拟机的多线程是通过线程轮流切换并分配处理器执行时间的方式来实现的。<br>所以在任一确定时刻，一个处理器只会执行一条线程的指令，因此，为了线程切换后能恢复到正确的执行位置，每条线程都是需要一个独立的程序计数器，各条线程之间互相不影响，独立存储。<br>如果说线程正在执行的是Java方法，计数器记录的就是正在执行的虚拟机字节码指令的地址，如果执行的是Native方法，这个计数器值就是空（Undefined）。这块区域也是为一个在Java虚拟机规范中没有规定任何内存溢出情况的区域。</p>
</blockquote>
<h2 id="虚拟机栈"><a href="#虚拟机栈" class="headerlink" title="虚拟机栈"></a>虚拟机栈</h2><blockquote>
<p>这一部分也是线程私有的，每个方法在执行的时候会创建一个栈桢。每个栈桢存储局部变表、操作数、动态链接、方法返回地址等。每一个方法的调用到执行完毕，对应一个栈桢在虚拟机栈中的如栈和出栈。局部变量表存放了编译器克可知的各种基本数据类型、 对象引用和returnAddress类型（一条指向字节码指令的地址），局部变量表所需的内存空间在编译期间就分配完成，当进入一个方法时，该方法需要的在桢中分配多大的局部变量空间时完全确定的，在运行期间不会改变局部变量表的大小。</p>
</blockquote>
<h2 id="本地方法栈"><a href="#本地方法栈" class="headerlink" title="本地方法栈"></a>本地方法栈</h2><blockquote>
<p>与虚拟机栈的作用和原理相似，区别是虚拟机栈是为执行Java方法服务，本地方法栈是为执行本地方法服务的。</p>
</blockquote>
<h2 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h2><blockquote>
<p>Java中的堆是用来存储对象本身的以及数组（数组引用是存放在Java栈中的），堆是被所有线程共享的，在JVM中只有一个堆。Java堆是垃圾收集器管理的主要区域，因为也被称为GC堆。</p>
</blockquote>
<h2 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h2><blockquote>
<p>方法区中存储了已经被虚拟机加载的类的信息（包括类的名称、方法信息、属性字段信息）、静态变量、常量以及编译器编译后的代码等。与堆一样，方法区也是被线程共享的区域。Java虚拟机规范堆这个区域的限制非常宽松。除了和Java堆一样不需要连续的内存和可以选择固定大小或者可扩展外，还可以选择不实现垃圾回收。运行时常量池时方法区的一部分，Class文件中除了有类的版本、字段、方法、接口等描述信息外，还有一项信息时常量池，用于存放编译期生成的各种字面量和符号引用，这部分内容将在类加载后存放到方法区的运行时常量池中。</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/08/Junit_3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="cui">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="山佳">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/08/Junit_3/" class="post-title-link" itemprop="url">Java之Junit进阶</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-08 17:35:01" itemprop="dateCreated datePublished" datetime="2020-03-08T17:35:01+08:00">2020-03-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-11 18:06:12" itemprop="dateModified" datetime="2020-03-11T18:06:12+08:00">2020-03-11</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/03/08/Junit_3/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/03/08/Junit_3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>Junit5已经出来，但因为习惯问题此处还是主要语句Junit4的主要用法。</p>
<h1 id="主要内容"><a href="#主要内容" class="headerlink" title="主要内容"></a>主要内容</h1><ul>
<li>测试套件</li>
<li>忽略测试方法</li>
<li>代码运行时间测试</li>
<li>定向异常测试</li>
</ul>
<h2 id="测试套件"><a href="#测试套件" class="headerlink" title="测试套件"></a>测试套件</h2><p>测试套件意味着捆绑几个单元测试用例并且一起执行他们。JUnit 中，使用@RunWith 和 @Suite 注释来运行套件测试。（被@RunWith 和 @Suite注释的测试类不需要任何方法，SuiteClasse中写上要一起执行的测试用例类）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import org.junit.runners.Suite;</span><br><span class="line">@RunWith(Suite.class)</span><br><span class="line">@Suite.SuiteClasses(&#123;</span><br><span class="line">   TestJunit1.class,</span><br><span class="line">   TestJunit2.class</span><br><span class="line">&#125;)</span><br><span class="line">public class JunitTestSuite &#123;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="忽略测试"><a href="#忽略测试" class="headerlink" title="忽略测试"></a>忽略测试</h2><p>有时因为各种原因（比如上面套件中，我们类中有并不想执行的用例）我们不想执行我们的测试用例。这是需要忽略掉这个测试用例。@Ignore 注释会在这种情况时帮助我们。</p>
<ul>
<li>一个含有 @Ignore 注释的测试方法将不会被执行。</li>
<li>如果一个测试类有 @Ignore 注释，则它的所有的测试方法将不会执行。</li>
</ul>
<h2 id="运行时间测试"><a href="#运行时间测试" class="headerlink" title="运行时间测试"></a>运行时间测试</h2><p>如果想验证一个测试用例是否比起指定的毫秒数花费了更多的时间。可以在@Test 注释中使用timeout 参数。<br><code>@Test(timeout=1000)</code></p>
<h2 id="定向异常测试"><a href="#定向异常测试" class="headerlink" title="定向异常测试"></a>定向异常测试</h2><p>你可以测试代码是否它抛出了想要得到的异常。可以在@Test 注释中使用expected 参数。例如<code>@Test(expected = ArithmeticException.class)</code> 就可以用来测试被注释的方法抛出的异常是不是ArithmeticException。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/02/Junit_2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="cui">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="山佳">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/02/Junit_2/" class="post-title-link" itemprop="url">Java之Junit应用</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-02 23:19:46" itemprop="dateCreated datePublished" datetime="2020-03-02T23:19:46+08:00">2020-03-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-06 18:03:34" itemprop="dateModified" datetime="2020-03-06T18:03:34+08:00">2020-03-06</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/03/02/Junit_2/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/03/02/Junit_2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>Junit5已经出来，但因为习惯问题此处还是主要语句Junit4的主要用法。</p>
<h1 id="Junit应用"><a href="#Junit应用" class="headerlink" title="Junit应用"></a>Junit应用</h1><h2 id="Junit-断言"><a href="#Junit-断言" class="headerlink" title="Junit 断言"></a>Junit 断言</h2><p>JUnit的编写，此处就不再举例说明了，如果不太清楚可以随便查一下。我们从断言开始入手。<br>所有的断言都包含在 Assert 类中。<br><code>public class Assert extends java.lang.Object</code><br>这个类提供了很多有用的断言方法来编写测试用例。只有失败的断言才会被记录。Assert 类中的一些有用的方法列式如下：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>void assertEquals(boolean expected, boolean actual)</td>
<td>检查两个变量或者等式是否平衡</td>
</tr>
<tr>
<td>void assertTrue(boolean expected, boolean actual)</td>
<td>检查条件为真</td>
</tr>
<tr>
<td>void assertFalse(boolean expected)</td>
<td>检查条件为假</td>
</tr>
<tr>
<td>void assertNotNull(Object object)</td>
<td>检查对象不为空</td>
</tr>
<tr>
<td>void assertNull(Object object)</td>
<td>检查对象为空</td>
</tr>
<tr>
<td>void assertSame(boolean condition)</td>
<td>检查两个相关对象是否指向同一个对象</td>
</tr>
<tr>
<td>void assertNotSame(boolean condition)</td>
<td>检查两个相关对象是否指向不同对象</td>
</tr>
<tr>
<td>void assertArrayEquals(expectedArray, resultArray)</td>
<td>检查两个数组是否相等</td>
</tr>
</tbody></table>
<h2 id="Junit-执行过程"><a href="#Junit-执行过程" class="headerlink" title="Junit 执行过程"></a>Junit 执行过程</h2><p>让我们通过一个例子来更好的理解Junit中的的方法的执行过程。首先创建一个java文件，命名为LearnJunit.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.After;</span><br><span class="line">import org.junit.AfterClass;</span><br><span class="line">import org.junit.Before;</span><br><span class="line">import org.junit.BeforeClass;</span><br><span class="line">import org.junit.Ignore;</span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">public class LearnJunit &#123;</span><br><span class="line"></span><br><span class="line">   &#x2F;&#x2F;execute only once, in the starting </span><br><span class="line">   @BeforeClass</span><br><span class="line">   public static void beforeClass() &#123;</span><br><span class="line">      System.out.println(&quot;this is before class method&quot;);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   &#x2F;&#x2F;execute only once, in the end</span><br><span class="line">   @AfterClass</span><br><span class="line">   public static void  afterClass() &#123;</span><br><span class="line">      System.out.println(&quot;this is after class method&quot;);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   &#x2F;&#x2F;execute for each test, before executing test</span><br><span class="line">   @Before</span><br><span class="line">   public void before() &#123;</span><br><span class="line">      System.out.println(&quot;this is before&quot;);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   &#x2F;&#x2F;execute for each test, after executing test</span><br><span class="line">   @After</span><br><span class="line">   public void after() &#123;</span><br><span class="line">      System.out.println(&quot;this is after&quot;);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   &#x2F;&#x2F;test case 1</span><br><span class="line">   @Test</span><br><span class="line">   public void testCase1() &#123;</span><br><span class="line">      System.out.println(&quot;this is the test case 1&quot;);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   &#x2F;&#x2F;test case 2</span><br><span class="line">   @Test</span><br><span class="line">   public void testCase2() &#123;</span><br><span class="line">      System.out.println(&quot;this is the test case 2&quot;);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之后在同一文件目录下创建一个java文件用来运行测试文件，命名为TestRunner.java。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.runner.JUnitCore;</span><br><span class="line">import org.junit.runner.Result;</span><br><span class="line">import org.junit.runner.notification.Failure;</span><br><span class="line"></span><br><span class="line">public class TestRunner &#123;</span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      Result result &#x3D; JUnitCore.runClasses(LearnJunit.class);</span><br><span class="line">      for (Failure failure : result.getFailures()) &#123;</span><br><span class="line">         System.out.println(failure.toString());</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.println(result.wasSuccessful());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译运行的结果是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">this is before class method</span><br><span class="line">this is before</span><br><span class="line">this is the test case 1</span><br><span class="line">this is after</span><br><span class="line">this is before</span><br><span class="line">this is the test case 2</span><br><span class="line">this is after</span><br><span class="line">this is after class method</span><br><span class="line">true</span><br></pre></td></tr></table></figure>
<p>最后的<code>true</code>是<code>result.wasSuccessful()</code>的结果，<code>Result result = JUnitCore.runClasses(LearnJunit.class);</code>是执行命令。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/29/Junit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="cui">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="山佳">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/29/Junit/" class="post-title-link" itemprop="url">Java篇之Junit介绍</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-01-29 23:48:57" itemprop="dateCreated datePublished" datetime="2020-01-29T23:48:57+08:00">2020-01-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-03 10:08:32" itemprop="dateModified" datetime="2020-03-03T10:08:32+08:00">2020-03-03</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/01/29/Junit/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/01/29/Junit/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="写在最前面"><a href="#写在最前面" class="headerlink" title="写在最前面"></a>写在最前面</h1><p>作为一名Java开发来说，平时说到单元测试就会想到Junit框架。一直都是简单的会用一下，详细的说起来到说不出什么，故此专门查漏一番。</p>
<h1 id="Junit介绍"><a href="#Junit介绍" class="headerlink" title="Junit介绍"></a>Junit介绍</h1><p>JUnit 是一个 Java 编程语言的单元测试框架。是起源于 JUnit 的一个统称为 xUnit 的单元测试框架之一。（xUnit是一系列测试框架的统称，最开始来源于一个叫做Smalltalk的SUnit框架。现在各种面向对象语言，Java、Python语等的类、对象等定义就是来源于Smalltalk语言，后来这些语言都借助了Sunit框架的理念，有很多通用的规范和特征，也就统称为xUnit。）<br>JUnit 促进了“先测试后编码”的理念，即可以先开发测试数据的一段代码，可以先测试，然后再应用。(but，一般我们都习惯了直接开发，即便是单元测试也是在开发完之后的工作了。😓)</p>
<h2 id="Junit特点"><a href="#Junit特点" class="headerlink" title="Junit特点"></a>Junit特点</h2><ol>
<li>是一个开放的资源框架，用于编写和运行测试。</li>
<li>提供注释来识别测试方法。  </li>
<li>提供断言来测试预期结果。  </li>
<li>提供测试运行来运行测试。  </li>
<li>优雅简洁；测试可以自动运行并且检查自身结果并提供即时反馈。</li>
<li>测试可以被组织为测试套件，包含测试用例，甚至其他的测试套件。</li>
</ol>
<h2 id="单元测试用例"><a href="#单元测试用例" class="headerlink" title="单元测试用例"></a>单元测试用例</h2><p>既然Junit是Java编程语言的单元测试框架。那什么是单元测试呢？<br>廖雪峰给的解释是，单元测试是用来对一个模块、一个函数或者一个类来进行正确性检验的测试工作。</p>
<h3 id="单元测试要求"><a href="#单元测试要求" class="headerlink" title="单元测试要求"></a>单元测试要求</h3><p>一个正式的编写好的单元测试用例的特点是：已知输入和预期输出，即在测试执行前就已知。已知输入需要测试的先决条件，预期输出需要测试后置条件。<br>每一项需求至少需要两个单元测试用例：一个正检验，一个负检验。如果一个需求有子需求，每一个子需求必须至少有正检验和负检验两个测试用例。</p>
<h2 id="Junit测试框架"><a href="#Junit测试框架" class="headerlink" title="Junit测试框架"></a>Junit测试框架</h2><p>Junit是一个回归测试框架。具有以下重要特性：测试工具、测试套件、测试运行器、测试分类</p>
<h3 id="测试工具"><a href="#测试工具" class="headerlink" title="测试工具"></a>测试工具</h3><p>测试工具是一整套固定的工具，用于基线测试。测试工具的目的是为了确保测试能够在共享且固定的环境中运行，因此保证测试结果的可重复性。它包括：<br>在所有测试调用指令发起前的 setUp() 方法。<br>在测试方法运行后的 tearDown() 方法。</p>
<h3 id="测试套件"><a href="#测试套件" class="headerlink" title="测试套件"></a>测试套件</h3><p>测试套件意味捆绑几个测试案例并且同时运行。在 JUnit 中，@RunWith 和 @Suite 都被用作运行测试套件。</p>
<h3 id="测试运行器"><a href="#测试运行器" class="headerlink" title="测试运行器"></a>测试运行器</h3><p>测试运行器 用于执行测试案例。</p>
<h3 id="测试分类"><a href="#测试分类" class="headerlink" title="测试分类"></a>测试分类</h3><p>测试分类是在编写和测试 JUnit 的重要分类。</p>
<ol>
<li>包含一套断言方法的测试断言</li>
<li>包含规定运行多重测试工具的测试用例</li>
<li>包含收集执行测试用例结果的方法的测试结果</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/29/hexo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="cui">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="山佳">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/29/hexo/" class="post-title-link" itemprop="url">Hexo篇</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-01-29 23:39:14" itemprop="dateCreated datePublished" datetime="2020-01-29T23:39:14+08:00">2020-01-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-12-26 16:22:38" itemprop="dateModified" datetime="2021-12-26T16:22:38+08:00">2021-12-26</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/01/29/hexo/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/01/29/hexo/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Hexo是什么："><a href="#Hexo是什么：" class="headerlink" title="Hexo是什么："></a>Hexo是什么：</h2><p>Hexo is a fast, simple and powerful blog framework. You write posts in <a href="http://daringfireball.net/projects/markdown/" target="_blank" rel="noopener">Markdown</a> (or other markup languages) and Hexo generates static files with a beautiful theme in seconds.<br>简单而言呢就是 Hexo是一个框架，这个框架能把我们基于markdown编写的内容，帮我们生成静态文件并上传到指定服务器，而且它有快捷、简单、有效的特点。</p>
<h2 id="Hexo-安装"><a href="#Hexo-安装" class="headerlink" title="Hexo 安装"></a>Hexo 安装</h2><p>因为 Hexo 是基于 node 框架的，所以我们需要首先安装node.js。接着执行命令安装Hexo<br><code>npm install hexo-cli -g</code></p>
<h2 id="Hexo-初始化"><a href="#Hexo-初始化" class="headerlink" title="Hexo 初始化"></a>Hexo 初始化</h2><ul>
<li>在本地新建文件夹blog </li>
<li>在文件夹下执行命令 <code>hexo init</code></li>
<li>成功之后执行命令 <code>hexo server</code> 启动本地服务器， 访问<a href="http://localhost:4000/" target="_blank" rel="noopener">http://localhost:4000</a>即可，显示的内容是即时渲染的。</li>
</ul>
<h2 id="Hexo命令"><a href="#Hexo命令" class="headerlink" title="Hexo命令"></a>Hexo命令</h2><p><em>这是本篇的重点，如果搭建博客过程中使用hexo有别的问题，可以查找专门搭建博客的帖子。</em></p>
<ul>
<li><p><code>hexo init [folder]</code><br>hexo init 初始化本地文件夹为网站的根目录。 [folder] 可选参数 指定初始化目录的路径，若无指定则默认为当前目录</p>
</li>
<li><p><code>hexo clean //清除静态文件，如果发现部署站点修改的内容不生效，可以试试</code>  </p>
</li>
<li><p><code>hexo generate (hexo g)  -d // 生成静态文件 -d 可选 生成后部署 等价于 hexo d -g</code></p>
</li>
<li><p><code>hexo server (hexo s) // 服务器运行</code></p>
</li>
<li><p><code>hexo deploy (hexo d) // 部署 -g 可选 表示生成后部署 等价于 hexo d -g</code></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">cui</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cui</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.7.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el: '#valine-comments',
      verify: false,
      notify: false,
      appId: 'YvpdhuwAHAdpXgzPHCtXHg08-gzGzoHsz',
      appKey: 'FKGcg90plr2dMxDRVrS8lG7r',
      placeholder: "Just go go",
      avatar: 'mm',
      meta: guest,
      pageSize: '10' || 10,
      visitor: false,
      lang: '' || 'zh-cn',
      path: location.pathname,
      recordIP: false,
      serverURLs: ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
